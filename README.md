# QRConnect

QRConnectは、QRコードを使用してスマートフォンとPC間でシームレスなデータ転送を可能にするプログレッシブウェブアプリ（PWA）です。レスポンシブデザインにより、モバイルデバイスでのQRコード生成とデスクトップでのQRコード読み取りを自動的に切り替え、大容量データ転送のための分割QR機能などの高度な機能を提供します。

## 機能

### 主要機能
- **QRコード生成**: モバイルデバイスでテキストをQRコードに変換
- **QRコード読み取り**: PCカメラを使用したQRコードスキャン
- **分割QR対応**: 大容量データ（400文字以上）を複数のQRコードに自動分割
- **レスポンシブデザイン**: デバイス自動検出と適切なUI表示
- **PWA対応**: モバイル・デスクトップ両方でネイティブアプリとしてインストール可能
- **日本語サポート**: 日本語テキストエンコーディングに最適化

### モバイル機能
- リアルタイムプレビュー付きQRコード生成
- 文字数制限検証（単一QR：400文字、分割モード：無制限）
- 大容量データ用の自動分割モード
- 様々な文字数サンプルでのテストテキスト生成
- より良い視認性のためのタップ拡大QRコードモーダル
- 生成画面とヘルプページ間のタブナビゲーション
- 前へ/次へコントロール付き分割QRナビゲーション

### デスクトップ機能
- カメラベースのQRコードスキャン
- リアルタイムQRコード検出
- マルチQR受信と自動データ再構築
- 分割QR進捗追跡
- スキャンしたデータのクリップボード統合

### 高度な機能
- **データ分割**: 大容量テキストの400文字セグメントへの自動チャンク化
- **チェックサム検証**: 各チャンクのデータ整合性確認
- **順序自由スキャン**: 任意の順序でのマルチQRデータ受信と自動データ再構築
- **重複検出**: 同一チャンクの重複受信を自動検出・スキップ
- **日本語テキスト最適化**: 日本語コンテンツ用に最適化された文字エンコーディング
- **包括的テスト**: 様々なユースケース用の組み込みテストデータ生成器

### 技術仕様
- **フレームワーク**: Next.js 15 with App Router
- **UIライブラリ**: React 19 with TypeScript
- **スタイリング**: Tailwind CSS v4
- **QR生成**: カスタム最適化された`qrcode`ライブラリ
- **QR読み取り**: マルチQR対応`@zxing/library`
- **PWA**: 高度なService WorkerとWeb App Manifest
- **キャッシュ戦略**: Workboxによる包括的オフラインサポート

## はじめに

### 前提条件
- Node.js 18.0以降
- npm、yarn、pnpm、またはbun

### インストール

1. リポジトリをクローン:
```bash
git clone https://github.com/yourusername/qrconnect.git
cd qrconnect
```

2. 依存関係をインストール:
```bash
npm install
# または
yarn install
# または
pnpm install
# または
bun install
```

3. 開発サーバーを起動:
```bash
npm run dev
# または
yarn dev
# または
pnpm dev
# または
bun dev
```

4. ブラウザで [http://localhost:3000](http://localhost:3000) を開く

## 使用方法

### モバイルでの使用（QRコード生成）

#### 単一QRモード（400文字以下）
1. スマートフォンでアプリを開く
2. テキストエリアにテキスト（400文字まで）を入力
3. QRコードが自動的に生成される
4. QRコードサムネイルをタップして拡大表示
5. PCのカメラでQRコードをスキャン

#### 分割QRモード（400文字超過）
1. 400文字を超えるテキストを入力
2. アプリが自動的に分割モードに切り替わる
3. 前へ/次へボタンで複数のQRコードをナビゲート
4. PCで各QRコードを順次スキャン
5. データが自動的に再構築される

### デスクトップでの使用（QRコード読み取り）

#### 単一QR受信
1. PCでアプリを開く
2. プロンプトでカメラアクセスを許可
3. モバイルデバイスで生成されたQRコードにカメラを向ける
4. スキャンしたデータが自動的に表示される

#### マルチQR受信
1. 分割シーケンスの任意のQRコードからスキャンを開始
2. アプリが進捗を表示（例：「2/4受信済み」）
3. 任意の順序で残りのQRコードをスキャン（1→2→3→4でも4→2→1→3でも可能）
4. 重複スキャンは自動的に検出・スキップされる
5. すべてのチャンクを受信すると、データが自動的に正しい順序で結合される
6. 完全なテキストが結果エリアに表示される

### その他の機能
- **文字数制限管理**: 単一QR400文字制限、大容量データは自動分割
- **テストテキスト生成**: 「テストテキスト生成」で特定文字数のサンプルテキストを生成
- **ヘルプ・技術情報**: 「ヘルプ・技術情報」タブで詳細なドキュメントにアクセス
- **PWAインストール**: デバイスのホーム画面にアプリをインストールしてクイックアクセス

## プロジェクト構造

```
qrconnect/
├── app/
│   ├── page.tsx              # PWAインストールプロンプト付きメインエントリーポイント
│   ├── globals.css           # グローバルスタイル
│   └── layout.tsx            # PWAメタデータ付きルートレイアウト
├── components/
│   ├── DeviceDetector.tsx    # デバイス検出ロジック
│   ├── MobileApp.tsx         # タブ付きモバイルアプリラッパー
│   ├── QRGenerator.tsx       # 分割対応QRコード生成
│   ├── QRReader.tsx          # マルチQR対応QRコード読み取り
│   ├── QRCodeModal.tsx       # QRコード拡大モーダル
│   ├── InfoPage.tsx          # ヘルプ・技術情報
│   └── PWAInstallPrompt.tsx  # スマートPWAインストールプロンプト
├── utils/
│   ├── testTextGenerator.ts  # テストテキスト生成ユーティリティ
│   └── dataSplitter.ts       # データ分割・再構築ロジック
├── public/
│   ├── manifest.json         # 包括的PWAマニフェスト
│   ├── sw.js                 # 自動生成Service Worker
│   ├── browserconfig.xml     # Windowsタイル設定
│   └── icons/                # PWAアイコン（SVG形式）
└── next.config.ts            # Next.js + PWA設定
```

## PWA設定

アプリは包括的なプログレッシブウェブアプリとして設定されています：

### マニフェスト機能
- **多言語サポート**: 日本語・英語メタデータ
- **アイコン**: スケーラブルSVGアイコン（192x192、512x512）
- **ショートカット**: 主要機能へのクイックアクセス
- **カテゴリ**: 生産性・ユーティリティとして分類
- **表示モード**: スタンドアロンアプリ体験

### Service Worker機能
- **オフラインサポート**: 完全なオフライン機能
- **スマートキャッシュ**: リソースタイプ別の異なる戦略
- **バックグラウンド同期**: 信頼性の高いデータ処理
- **自動更新**: シームレスなアプリ更新

### インストール機能
- **スマートプロンプト**: コンテキスト対応のインストール提案
- **クロスプラットフォーム**: iOS SafariとAndroid Chromeサポート
- **ネイティブ感**: スタンドアロンアプリ体験

## 文字数制限と分割ロジック

### 単一QRモード
- **制限**: 400文字（日本語テキスト最適化）
- **エンコーディング**: エラー訂正レベルMのUTF-8
- **用途**: 短いメッセージ、URL、連絡先情報

### 分割QRモード
- **チャンクサイズ**: QRコード1つあたり400文字
- **メタデータ**: チャンクあたり14文字（インデックス、合計、チェックサム）
- **総容量**: 無制限（6000文字以上でテスト済み）
- **再構築**: データ整合性確認付き自動処理

### 日本語テキスト最適化
- **文字密度**: 日本語文字の複雑さに最適化
- **バイト効率**: 3バイトUTF-8エンコーディングを考慮
- **QR可読性**: カメラスキャンの信頼性とのバランス

## ブラウザサポート

### モバイルブラウザ
- **iOS Safari**: ホーム画面インストール付き完全PWAサポート
- **Android Chrome**: 完全なPWA機能
- **Firefox Mobile**: カメラアクセスとQR生成
- **Samsung Internet**: 完全互換性

### デスクトップブラウザ
- **Chrome**: 完全なカメラアクセスとPWAインストール
- **Firefox**: 完全機能
- **Safari**: QR読み取りとPWAサポート
- **Edge**: 完全機能サポート

### 要件
- **カメラアクセス**: デスクトップでのQRコードスキャンに必要
- **JavaScript**: モダンES6+サポート必要
- **ローカルストレージ**: PWAインストール設定用

## 開発

### ビルドコマンド
```bash
# 開発サーバー
npm run dev

# プロダクションビルド
npm run build

# プロダクションサーバー起動
npm start

# コードリント
npm run lint
```

### 環境セットアップ
- TypeScript設定済み
- ESLintルール設定済み
- Tailwind CSS設定済み
- PWA Service Worker自動生成

## パフォーマンス

### 最適化機能
- **静的生成**: 高速読み込み用の事前レンダリングページ
- **画像最適化**: 自動画像圧縮・サイズ調整
- **コード分割**: 効率的なバンドル読み込み
- **キャッシュ戦略**: 最適パフォーマンス用の多層キャッシュ

### バンドル分析
- メインバンドル: 約238KB（QRライブラリ含む）
- First Load JS: 約101KB共有
- PWAアセット: オフライン用キャッシュ

## コントリビューション

1. リポジトリをフォーク
2. フィーチャーブランチを作成（`git checkout -b feature/amazing-feature`）
3. TypeScript・ESLint規約に従う
4. モバイル・デスクトップ両方の機能をテスト
5. PWAインストールが動作することを確認
6. 変更をコミット（`git commit -m 'Add some amazing feature'`）
7. ブランチにプッシュ（`git push origin feature/amazing-feature`）
8. プルリクエストを開く

### 開発ガイドライン
- レスポンシブデザイン原則を維持
- 様々な文字数・言語でテスト
- PWA機能が維持されることを確認
- 既存のコードパターンに従って一貫性を保つ

## ライセンス

このプロジェクトはMITライセンスの下でライセンスされています。詳細は[LICENSE](LICENSE)ファイルをご覧ください。

## 謝辞

- [Next.js](https://nextjs.org/)で構築
- QRコード生成は[qrcode](https://github.com/soldair/node-qrcode)により提供
- QRコード読み取りは[ZXing](https://github.com/zxing-js/library)により提供
- [Tailwind CSS](https://tailwindcss.com/)でスタイリング
- PWA機能は[next-pwa](https://github.com/shadowwalker/next-pwa)により提供
- QRコード視認性最適化のためのカスタムデザインアイコン・UIコンポーネント

## ロードマップ

### 予定機能
- [ ] バッチQRコード生成
- [ ] QRコードスタイリングオプション
- [ ] QRコードの画像エクスポート
- [ ] 大容量ペイロード用データ圧縮
- [ ] 暗号化データ転送オプション
- [ ] マルチ言語UI対応
- [ ] QRコード履歴・お気に入り機能

## トラブルシューティング

### よくある問題

**Q: QRコードが生成されない**
A: テキスト入力後、少し待ってください。400文字を超える場合は自動的に分割モードに切り替わります。

**Q: カメラでQRコードを読み取れない**
A: 照明を明るくし、QRコードにカメラを近づけて、画面が安定するまで待ってください。

**Q: 分割QRの順序が分からない**
A: 各QRコードには「1/4」のようなインデックスが表示されます。任意の順序でスキャンできますが、すべてのチャンクをスキャンする必要があります。

**Q: PWAインストールができない**
A: ブラウザがPWAをサポートしているか確認し、HTTPSで接続していることを確認してください。

### サポート

問題が発生した場合は、[GitHub Issues](https://github.com/yourusername/qrconnect/issues)で報告してください。